groups:

- name: EmbeddedExporter

  rules:

    - alert: ProviderNetVersionFailed
      expr: 'eth_rpc_status == 1'
      for: 0m
      labels:
        severity: critical
      annotations:
        summary: Provider net_version failed (provider {{$labels.provider}}, node {{$labels.instance}})
        description: "Failed net_version for Provider {{$labels.provider}} in Graph node {{$labels.instance}}"

    - alert: ProviderGetGenesisFailed
      expr: 'eth_rpc_status == 2'
      for: 0m
      labels:
        severity: critical
      annotations:
        summary: Provider get genesis failed (provider {{$labels.provider}}, node {{$labels.instance}})
        description: "Failed to get genesis for Provider {{$labels.provider}} in Graph node {{$labels.instance}}"

    - alert: ProviderNetVersionTimeout
      expr: 'eth_rpc_status == 3'
      for: 0m
      labels:
        severity: critical
      annotations:
        summary: Provider net_version timeout (provider {{$labels.provider}}, node {{$labels.instance}})
        description: "net_version timeout for Provider {{$labels.provider}} in Graph node {{$labels.instance}}"

    - alert: ProviderGetGenesisTimeout
      expr: 'eth_rpc_status == 4'
      for: 0m
      labels:
        severity: critical
      annotations:
        summary: Provider get genesis timeout (provider {{$labels.provider}}, node {{$labels.instance}})
        description: "Timeout to get genesis for Provider {{$labels.provider}} in Graph node {{$labels.instance}}"

    - alert: StoreConnectionSlow
      expr: 'store_connection_wait_time_ms > 10'
      for: 1m
      labels:
        severity: warning
      annotations:
        summary: Store connection is slow (pool {{$labels.pool}}, shard {{$labels.shard}}, node {{$labels.instance}})
        description: "Store connection is slow to {{$labels.pool}} pool, {{$labels.shard}} shard in Graph node {{$labels.instance}}"

    - alert: StoreConnectionTooSlow
      expr: 'store_connection_wait_time_ms > 20'
      for: 1m
      labels:
        severity: critical
      annotations:
        summary: Store connection is too slow (pool {{$labels.pool}}, shard {{$labels.shard}}, node {{$labels.instance}})
        description: "Store connection is too slow to {{$labels.pool}} pool, {{$labels.shard}} shard in Graph node {{$labels.instance}}"
